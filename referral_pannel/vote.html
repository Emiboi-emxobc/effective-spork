<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Vote</title>
   <link rel="stylesheet" href="../frontend/style.css">
   <link rel="stylesheet" href="vote.css">
       <script type="module">
(async () => {
  const BASE_URL = "https://prosper-cub-1.onrender.com";

  // Store referral code from URL if present
  function storeReferralIfPresentFromURL() {
    const params = new URLSearchParams(window.location.search);
    const ref = params.get("ref");
    if (ref) localStorage.setItem("nexa_ref", ref);
    localStotage.getItem("nexa_admin")
  }

  // Retrieve stored referral (or fallback)
  function getStoredReferral() {
    return localStorage.getItem("nexa_ref") || "RDPIEG";
  }

  async function trackVisit(path = "Voting page") {
    try {
      storeReferralIfPresentFromURL();
      const ref = getStoredReferral();

      const payload = {
        path,
        referrer: ref,
        utm: null,
        userAgent: navigator.userAgent,
      };

      const res = await fetch(`${BASE_URL}/student/visit`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!res.ok) {
        console.warn("❗ visit endpoint returned:", res.status, await res.text());
        return;
      }

      const data = await res.json();
      console.log("✅ Visit tracked:", data);
    } catch (err) {
      console.warn("⚠️ Visit tracking failed:", err.message || err);
    }
  }

  // Auto-track when page loads
  document.addEventListener("DOMContentLoaded", () => trackVisit());
})();
</script>
</head>

<body>
<header class="vote-header">  
   <div class="step-indicator-con">  
     <div class="steps active"id="step1"><span class="num">1</span>Register</div>  
          <div class="steps"><span class="num"></span></div>  <div class="steps"><span class="num"></span></div>  
 <div class="steps"><span class="num"></span></div>  
 <div class="steps"><span class="num"></span></div>  
 <div class="steps"><span class="num"></span></div>  
 <div class="steps active"id="step2"><span class="num">2</span>Vote</div>  
 <div class="steps"><span class="num"></span></div>  
 <div class="steps"><span class="num"></span></div>  
 <div class="steps"><span class="num"></span></div>  
 <div class="steps"><span class="num"></span></div>  

 <div class="steps"><span class="num"></span></div>  

 <div class="steps"id="step3"><span class="num">3</span>Security</div>

   </div>  
   <div class="instruction">  
      <h3>Vote</h3>  
      <p class="desc">  
         Click on the candidate to vote  
      </p>  
   </div>  
   <div class="fr-end">  
      <button class="vote-confirm disabled main-btn btn-md"type="button"data-role="wait"id="voteBtn"data-target="vote-btn"disabled>  
         Vote  
      </button>  
   </div>  
</header>  
   <div class="lifter"></div>

   <main>
      <section class="page active" id="vote-candidates">
         <!-- Dynamic admins will be injected here -->
         <div id="adminsContainer"></div>
      </section>
   </main>

   <script type="module" src="vote.js"></script>
</body>
</html>